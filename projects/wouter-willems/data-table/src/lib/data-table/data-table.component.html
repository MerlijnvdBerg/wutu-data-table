<wutu-lib-style></wutu-lib-style>

<div class="topButtons">
	<div class="amountPicker">
		Show
		<select [(ngModel)]="itemsPerPage" (ngModelChange)="itemsPerPageChanged()">
			<option value="10">10</option>
			<option value="25">25</option>
			<option value="50">50</option>
			<option value="100">100</option>
		</select>
		results
	</div>
	<div>
		<ng-container [ngTemplateOutlet]="searchInputRef" [ngTemplateOutletContext]="{changeHandler: searchQueryChanged}"></ng-container>
	</div>
</div>

<div
	class="tableContainer"
	[ngClass]="{horizontalScroll: horizontalScroll || columnWidthsToBeCalculated, withPaddings: !columnWidthsToBeCalculated}"
>
	<table [ngClass]="{actionMenuOpen: hasActionMenuOpen(), fullWidth: horizontalScroll || !columnWidthsToBeCalculated}">
		<thead>
		<tr>
			<td (click)="headerSelectClicked()">
				<div class="selectBox">
					<ng-container [ngTemplateOutlet]="checkboxRef" [ngTemplateOutletContext]="{isSelected: getHeaderSelectState()}"></ng-container>
				</div>
			</td>
			<td *ngFor="let header of headers; index as index">
				<div class="colHeader">
					<div class="caption" [klpWithTooltip]="true">{{header}}</div>
					<button class="sortButton" (click)="setSortField(headerKeys[index])">
						<svg height="5" width="10" [ngClass]="{'visible': sortField !== headerKeys[index] || sortOrder !== 'DESC'}"><polygon points="0,5 5,0 10,5" style="fill:#515365;" /></svg>
						<svg height="5" width="10" [ngClass]="{'visible': sortField !== headerKeys[index] || sortOrder !== 'ASC'}"><polygon points="0,0 5,5 10,0" style="fill:#515365;" /></svg>
					</button>
				</div>
			</td>
			<td>
				<ng-container [ngTemplateOutlet]="configBtnRef" [ngTemplateOutletContext]="{clickHandler: openConfig}"></ng-container>
			</td>
		</tr>
		</thead>
		<tbody>
		<tr *ngFor="let row of stuff?.data">
			<td (click)="rowSelectClicked(row)">
				<div class="selectBox">
					<ng-container [ngTemplateOutlet]="checkboxRef" [ngTemplateOutletContext]="{isSelected: isSelected(row)}"></ng-container>
				</div>
			</td>
			<td *ngFor="let header of headerKeys" (click)="rowClicked(row)" [klpWithTooltip]="true">
				<ng-container
					[ngTemplateOutlet]="getTemplate(header, row[header])"
					[ngTemplateOutletContext]="{ value: row[header] }"
				></ng-container>
			</td>
			<td>
				<div class="actionMenuContainer">
					<ng-container [ngTemplateOutlet]="actionMenuBtnRef" [ngTemplateOutletContext]="{clickHandler: getShowActionsFn(row)}"></ng-container>
					<div
						class="actionMenu"
						*ngIf="actionMenuActionForRow === row"
						[ngStyle]="{transform: 'translate('+actionMenuOffset.x+ 'px,'+ actionMenuOffset.y + 'px)'}"
					>
						<button *ngFor="let action of actions" (click)="action.action()">
							{{action.caption}}
						</button>
					</div>
				</div>
			</td>
		</tr>
		</tbody>
	</table>
</div>

<footer *ngIf="stuff">
	<div>
		Showing {{(currentPage -1) * itemsPerPage + 1}} to {{(currentPage -1) * itemsPerPage + stuff.data.length}} of {{stuff.totalAmount}} results
	</div>
	<div class="pageNumbers" *ngIf="stuff">
		<button (click)="toPage(1)" [disabled]="currentPage === 1">First</button>
		<button (click)="toPage(currentPage-1)" [disabled]="currentPage === 1">Previous</button>
		<div class="pageNrButtons">
			<button class="pageNrButton" *ngFor="let pageNr of getPageNumbers()" (click)="toPage(pageNr)" [ngClass]="{selected: currentPage === pageNr}">
				<span>{{pageNr}}</span>
			</button>
		</div>
		<button (click)="toPage(currentPage+1)" [disabled]="currentPage === this.getLastPage()">Next</button>
		<button (click)="toPage(this.getLastPage())" [disabled]="currentPage === this.getLastPage()">Last</button>
	</div>
</footer>

<div class="columnRearranger" *ngIf="showConfig">
	<header>
		<div>Rearrange and enable columns</div>
		<button class="closeButton" (click)="closeConfig()">X</button>
	</header>
	<wutu-column-rearranger [(ngModel)]="definedColumns" (onCloseRequest)="closeConfig()" (onColumnsSaved)="extractHeaders()"></wutu-column-rearranger>
</div>
